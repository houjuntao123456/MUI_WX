<html>

<head>
  <title>订单管理</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link href="./mui/css/mui.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="./css/iconfont.css">
  <!-- <script src="./mui/js/mui.min.js"></script> -->
  <script src="./js/jquery.min.js"></script>
  <script src="./js/loading.js"></script>
  <link rel="stylesheet" href="./css/loading.css">
  <style>
    a:hover {
      text-decoration: none;
    }

    li {
      list-style: none;
      background-color: white;
      border-right: 1px solid #cccccc;
      border-bottom: 1px solid #cccccc;
      text-align: center;
    }

    /* 内容的样式 */
    .div_mddd {
      text-align: center;
      height: 50px;
      line-height: 50px;

    }

    .div_spdd {
      text-align: center;
      line-height: 50px;
    }

    /* 资料显示的样式 */
    .li_style {
      border-right: none;
      height: 147px;
    }

    .li_photo_style {
      border: 1px solid black;
    }

    .title_display {
      display: none;

    }

    .bg_style_tab {
      background-color: orange;
      color: white;
    }

    select {
      appearance: none;
      -moz-appearance: none;
      -webkit-appearance: none;
      /* select手机上居中 */
      text-align-last: center;
    }

    .span_font_style {
      /* background-color: #3abeee; */
      background: -webkit-linear-gradient(0deg, rgba(233, 153, 4, 0.973), #f5f10cf1);
      /* Safari 5.1 - 6.0 */
      background: -o-linear-gradient(0deg, rgba(247, 168, 23, 0.973), #f5f10cf1);
      /* Opera 11.1 - 12.0 */
      background: -moz-linear-gradient(0deg, rgba(233, 153, 4, 0.973), #f5f10cf1);
      /* Firefox 3.6 - 15 */
      background: linear-gradient(0deg, rgba(233, 153, 4, 0.973), #f5f10cf1);
      /* 标准的语法（必须放在最后） */
      /* 标准的语法（必须放在最后） */
      color: white;
      background-color: orange;
      border-radius: 10px;
      font-size: 20px;
    }

    .div_style {
      text-align: left;
      overflow: hidden;

      line-height: 40px;
    }

    .div_style_1 {
      border-bottom: 1px solid #cccccc;
    }

    .input_style {

      float: right;
      margin-bottom: 10px;
    }

    /* 样式 */
    .oa-contact-cell.mui-table .mui-table-cell {
      padding: 11px 0;
      vertical-align: middle;
    }

    .oa-contact-cell {
      position: relative;
      margin: -11px 0;
      padding-left: 10px;
    }

    .oa-contact-content {
      width: 100%;

    }

    .oa-contact-name,
    oa-contact-position {
      float: left;
    }

    li {
      border: none;
    }

    /* .mui-bar-nav~.mui-content {
      padding-top: 20px;
    } */

    /* 隐藏下拉加载的图标*/
    .mui-pull-top-pocket .mui-pull {
      display: none;
    }

    .mui-table-view-chevron .mui-table-view-cell {
      padding-right: 20px;
    }

    .mui-btn-danger {
      border: 1px solid #1b69f2;
      background-color: #1b69f2;
    }

    select {
      margin-bottom: 5px;
    }

    .mui-table-view-cell::after {
      left: 0;
      right: 0;
      background-color: #ececed;
    }

    input[type="search"] {
      margin-bottom: 5px;
    }

    .mui-table-view::before,
    .mui-table-view::after {
      background-color: #ececed;
    }

    .mui-search .mui-placeholder {
      font-size: 14px;
      line-height: 30px;
    }

    .mui-input-row select {
      font-size: 15px;
      height: 30px;
    }
  </style>
</head>

<body>
  <!-- 头部 -->
  <header class="mui-bar mui-bar-nav">
    <h1 class="mui-title">订单管理</h1>
  </header>
  <!-- 大佛IG后家 -->
  <div id="pullrefresh" class="mui-content mui-scroll-wrapper">
    <div class="mui-scroll">
      <br>
      <!-- 内容头 -->
      <div id="content_head">
        <!-- 查询卡号 -->
        <div class="mui-row">
          <div class="mui-col-xs-1 mui-col-sm-1">
          </div>
          <div class="mui-col-xs-12 mui-col-sm-12">
            <div class="mui-input-row mui-search">
              <input type="search" class="mui-input-clear" placeholder=" 卡号   请输入要查询的卡号"
                style="background:white;height: 30px;" id="code">
            </div>
          </div>
          <div class="mui-col-xs-1 mui-col-sm-1">
          </div>
        </div>
        <!-- 选择组织 -->
        <div class="mui-input-row mui-select">
          <select style="text-align: center;color:rgb(144, 140, 140);font-size: 14px;" id="a_org"
            onchange="onload_select()">
            <!-- <option value=" " selected="selected">选择组织</option> -->
          </select>
        </div>
        <!-- 所以门店 -->
        <div class="mui-input-row mui-select">
          <select style="text-align: center;color:rgb(144, 140, 140);font-size: 14px;" id="picture"
            onchange="picture_yang_gw()">
            <!-- <option value=" " selected="selected">选择门店</option> -->
          </select>
        </div>
        <!-- 所以门店 -->
        <div class="mui-input-row mui-select">
          <select style="text-align: center;color:rgb(144, 140, 140);font-size: 14px;" id="picture_yang">
            <!-- <option value=" " selected="selected">形象顾问</option> -->
          </select>
        </div>
        <div class="mui-button-row" style="height: 45px;">
          <button type="button" class="mui-btn mui-btn-danger" style="width:300px;font-size: 15px;letter-spacing: 2px;"
            id="query">查询</button>
        </div>
      </div>
      <!--数据列表-->
      <ul class="mui-table-view mui-table-view-chevron" id="member_data">
        <!-- 里面详细内容 -->
        <!-- <li class="mui-table-view-cell" style="padding-left:5px;padding-right: 11px;">
          <div class="mui-slider-cell">
            <div class="oa-contact-cell mui-table">
              <div class="mui-table-cell" style="width:100px;height:100px;">
                <img src="./images/g.jpg" style="width:79%;height:100%;border: 1px solid black;border-radius:50%;" />
              </div>
              <div class="oa-contact-content mui-table-cell" style="padding-top:10px;padding-left: 12px;">
                <div class="mui-clearfix" style="text-align:left;line-height: 28px;width: 100%;">
                  <h4 class="oa-contact-name">叶文洁</h4>&nbsp;
                  <button style="float: right;padding: 7px 10px;color: #77a1f8;border: 1px solid #77a1f8;margin-top:10%;">订单详情</button>
                  <p class="mui-h6" style="text-align:left;width: 80%;">
                    <span style="font-weight:bold;font-size:15px;">¥</span>
                    <span>25.5</span>
                    <span>&nbsp;/</span>
                    <span>1</span>
                    <span>&nbsp;积分</span>
                  </p>
                  <p style="font-size:15px;color: #757171;">订单时间 <span class="oa-contact-position mui-h5"
                      style="color:#97989c;">1964-12-27</span></p>
                </div>
              </div>
            </div>
          </div>
        </li> -->
      </ul>
    </div>
  </div>
</body>
<script src="./mui/js/muiR.js"></script>
<script>
  var load = new Loading();
  load.init();

  //获取父页面

  window.onload = function () {
    // 进来查询下拉
    all_org();
    onload_select_innerHTML();

  }
  // 加载下拉内容
  function onload_select_innerHTML() {
    // 给组织加载多余
    var option_org = document.createElement("option");
    option_org.value = "";
    option_org.innerHTML = "选择组织";
    document.getElementById("a_org").appendChild(option_org);

    var option_picture = document.createElement("option");
    option_picture.value = "";
    option_picture.innerHTML = "选择门店";
    document.getElementById("picture").appendChild(option_picture);

    var option_picture_yang = document.createElement("option");
    option_picture_yang.value = "";
    option_picture_yang.innerHTML = "形象顾问";
    document.getElementById("picture_yang").appendChild(option_picture_yang);
  }
  var picture = document.getElementById("picture");
  var aorg = document.getElementById("a_org");
  var pictureyang = document.getElementById("picture_yang");
  //苹果手机采用CSS1
  if (/iphone/i.test(navigator.userAgent)) {
    //alert("苹果");
    picture.style.paddingLeft = "42%";
    aorg.style.paddingLeft = "42%";
    pictureyang.style.paddingLeft = "42%";
    // addStyleLink('CSS1.css');
  }
  // 安卓手机采用CSS2
  if (/android/i.test(navigator.userAgent)) {
    // alert("安卓");
    picture.style.paddingLeft = "0px";
    aorg.style.paddingLeft = "0px";
    pictureyang.style.paddingLeft = "0px";
    // addStyleLink('CSS2.css');
  }
  // 进来加载的方法
  function all_org() {
    load.start();
    mui.post('/index.php/UserlistOrg/', {
    }, function (data) {
      //服务器返回响应，根据响应结果，分析是否登录成功；
      if (data.code == 200) {
        for (i = 0; i < data.data.length; i++) {

          var option = document.createElement('option');
          option.value = data.data[i].code;
          option.innerHTML = data.data[i].name
          document.getElementById("a_org").appendChild(option);
        }
        load.stop();
      }
    }, 'json'
    );
  }


  // 点击选择组织
  function onload_select() {
    select_org = document.getElementById("a_org").options[document.getElementById("a_org").selectedIndex].value;

    load.start();

    mui.post('/index.php/UserlistStore/', {
      code: document.getElementById("a_org").options[document.getElementById("a_org").selectedIndex].value
    }, function (data) {
      //服务器返回响应，根据响应结果，分析是否登录成功；
      if (data.code == 200) {
        document.getElementById("picture").innerHTML = '<option value=" " selected = "selected">选择门店</option>';
        for (i = 0; i < data.data.length; i++) {
          var option = document.createElement('option');
          option.value = data.data[i].code;
          option.innerHTML = data.data[i].name
          document.getElementById("picture").appendChild(option);
        }
        load.stop();
      }
    }, 'json'
    );
  }


  // 点击选择门店
  function picture_yang_gw() {
    select_store = document.getElementById("picture").options[document.getElementById("picture").selectedIndex].value;


    load.start();

    mui.post('/index.php/UserlistStaff/', {
      code: document.getElementById("picture").options[document.getElementById("picture").selectedIndex].value
    }, function (data) {
      //服务器返回响应，根据响应结果，分析是否登录成功；
      if (data.code == 200) {
        document.getElementById("picture_yang").innerHTML = '<option value=" " selected = "selected">形象顾问</option>';
        for (i = 0; i < data.data.length; i++) {
          var option = document.createElement('option');
          option.value = data.data[i].code;
          option.innerHTML = data.data[i].name
          document.getElementById("picture_yang").appendChild(option);
        }
        load.stop();
      }
    }, 'json'
    );
  }
  // 点击按钮查询
  var query = document.getElementById("query");
  query.onclick = function () {
    select_staff = document.getElementById("picture_yang").options[document.getElementById("picture_yang").selectedIndex].value;
    load.start();
    count = 0;
    mui('#pullrefresh').pullRefresh().refresh(true);
    pullupRefresh();
    setTimeout(function () { document.getElementById("member_data").innerHTML = ""; }, 1000)
  }
</script>
<script>
  mui.init({
    pullRefresh: {
      container: '#pullrefresh',
      down: {
        callback: pulldownRefresh
      },
      up: {
        contentrefresh: '正在加载...',
        auto: true,//可选,默认false.首次加载自动上拉刷新一次
        callback: pullupRefresh
      }
    }
  });
  /**
   * 下拉刷新具体业务实现
   */
  function pulldownRefresh() {
  }
  /**
   * 上拉加载具体业务实现
   */
  // 重新开启加载
  // mui('#pullrefresh').pullRefresh().refresh(true);
  // 分页计数
  var count = 0;
  // 分的条数
  var limit_num = 30;
  var select_org = "";
  var select_store = "";
  var select_staff = "";

  function pullupRefresh() {
    load.start();
    mui.post('/index.php/OrderManagement/', {
      code: document.getElementById("code").value,
      org: select_org,
      store: select_store,
      staff: select_staff,
      page: ++count,
      limit: limit_num
    }, function (data) {
      //服务器返回响应，根据响应结果，分析是否登录成功；
      if (data.code == 200) {
        setTimeout(function () {
          mui('#pullrefresh').pullRefresh().endPullupToRefresh((count > (data.data.count / limit_num))); //参数为true代表没有更多数据了。
          var table = document.body.querySelector('.mui-table-view');
          if (data.data.count == 0) {
            var li = document.createElement('li');
            li.className = 'mui-table-view-cell';
            li.style = 'padding-left:5px;padding-right: 11px;padding-top:20px;margin-top:1px;';
            li.innerHTML = '<h2>没有数据<h2/>';
            table.appendChild(li);
          } else {

            for (i = 0; i < data.data.data.length; i++) {
              // 进行判断,如果为空执行默认路径的图片
              if (data.data.data[i].img == "" || data.data.data[i].img == " " || data.data.data[i].img == null) {
                data.data.data[i].img = "./images/suoke.jpg";
              }
              var judge = data.data.data[i].vip_name.toLowerCase(); //转换小写
              if ((judge == "") || (judge == null) || (judge == undefined) || (judge == "null")) {
                data.data.data[i].vip_name = " ";
              }

              if ((data.data.data[i].number == "") || (data.data.data[i].number == null) || (data.data.data[i].number == undefined) || (data.data.data[i].number == "null")) {
                data.data.data[i].number = 0;
              }

              if (data.data.data[i].money == "" || data.data.data[i].money == null || data.data.data[i].money == undefined) {
                data.data.data[i].money = 0;
              }
              if (data.data.data[i].consumption_times == "" || data.data.data[i].consumption_times == null || data.data.data[i].consumption_times == undefined) {
                data.data.data[i].consumption_times = 0;
              }
              if (data.data.data[i].consumption_number == "" || data.data.data[i].consumption_number == null || data.data.data[i].consumption_number == undefined) {
                data.data.data[i].consumption_number = 0;
              }
              if ((data.data.data[i].m_status == 1) || (data.data.data[i].m_status == "1")) {
                // 1隐藏
                var li = document.createElement('li');
                li.className = 'mui-table-view-cell';
                li.style = 'padding:15px 11px 12px 5px';
                li.innerHTML = '<div class="mui-slider-cell">'
                  + '<div class="oa-contact-cell mui-table">'
                  + '<div class="mui-table-cell" style="width:75px">'
                  + '<img class="img_member" vip_code="' + data.data.data[i].vip_code + '" src="' + data.data.data[i].img + '"alt="暂无图片" style="width:100%;border: 1px solid #ececed;border-radius:50%;"/>'
                  + '</div>'
                  + '<div class="oa-contact-content mui-table-cell" style="padding-top:10px;padding-left: 18px;">'
                  + '<div class="mui-clearfix" style="text-align:left;line-height: 28px;width: 65%;">'
                  + '<h4 class="oa-contact-name">' + data.data.data[i].vip_name + '</h4>&nbsp;'
                  + '<p class="mui-h6" style="text-align:left;line-height: 22px;display: flex;">'
                  + '<span style="font-weight:bold;font-size:15px;">¥</span>'
                  + '<span>' + data.data.data[i].money + ' /' + data.data.data[i].number + '件</span>'
                  + '</p>'
                  + '<p style="font-size:12px;color: #757171;line-height: 20px;display: flex;">订单时间&nbsp;<span class="oa-contact-position"style="color:#97989c;font-size: 12px;">' + data.data.data[i].date + '</span></p>'
                  + ' </div>'
                  + ' </div>'
                  + '<button style="right: 0px; position: absolute;top: 30px;padding: 7px 10px;color: #77a1f8;border: 1px solid #77a1f8;" id="' + data.data.data[i].code + '" onclick="member(this)">订单详情</button>'
                  + ' </div>'
                  + ' </div>'
                table.appendChild(li);
              } else {
                //  0显示
                var li = document.createElement('li');
                li.className = 'mui-table-view-cell';
                li.style = 'padding:15px 11px 12px 5px';
                li.innerHTML = '<div class="mui-slider-cell">'
                  + '<div class="oa-contact-cell mui-table">'
                  + '<div class="mui-table-cell" style="width:75px">'
                  + '<img class="img_member" vip_code="' + data.data.data[i].vip_code + '" src="' + data.data.data[i].img + '"alt="暂无图片" style="width:100%;border: 1px solid #ececed;border-radius:50%;"/>'
                  + '</div>'
                  + '<div class="oa-contact-content mui-table-cell" style="padding-top:10px;padding-left: 18px;">'
                  + '<div class="mui-clearfix" style="text-align:left;line-height: 28px;width: 65%;">'
                  + '<h4 class="oa-contact-name">' + data.data.data[i].vip_name + '</h4>&nbsp;'
                  + '<p class="mui-h6" style="text-align:left;line-height: 22px;display: flex;">'
                  + '<span style="font-weight:bold;font-size:15px;">¥</span>'
                  + '<span>' + data.data.data[i].money + ' /' + data.data.data[i].number + '件</span>'
                  + '</p>'
                  + '<p style="font-size:12px;color: #757171;line-height: 20px;display: flex;">订单时间&nbsp;<span class="oa-contact-position"style="color:#97989c;font-size: 12px;">' + data.data.data[i].date + '</span></p>'
                  + ' </div>'
                  + ' </div>'
                  + '<button style="right: 0px; position: absolute;top: 6px;padding: 7px 10px;color: #77a1f8;border: 1px solid #77a1f8;" id="' + data.data.data[i].code + '" onclick="member(this)">订单详情</button>'
                  + '<button style="right: 0px; position: absolute;top: 48px;padding: 7px 10px;color: #77a1f8;border: 1px solid #77a1f8;" level_code="' + data.data.data[i].level_code + ' " username="' + data.data.data[i].vip_name + '" vip_code="' + data.data.data[i].vip_code + '" code="' + data.data.data[i].code + '" onclick="first_Interaction(this)">首次互动</button>'
                  + ' </div>'
                  + ' </div>'
                table.appendChild(li);
              }
            }
          }
          load.stop();
        }, 1000);

      }
    }, 'json'
    );
  }
  mui('.mui-scroll-wrapper').scroll({
    indicators: false, //是否显示滚动条
  });
  // 点击按钮,将参数传递到另一个页面
  function member(e) {
    location.href = './homepage/order_details.html?' + 'id=' + e.getAttribute("id");
  }

  function first_Interaction(e) {
    localStorage.setItem("hd_username", e.getAttribute("username"));
    location.href = './homepage/first_Interaction.html?' + 'code=' + e.getAttribute("vip_code") + "level_code*" + e.getAttribute("level_code") + "dd_code$" + e.getAttribute("code");
  }

  mui("#member_data").on('tap', '.img_member', function () {
    //获取id
    // var code = this.getAttribute("vip_code");
    //传值给详情页面，通知加载新数据
    // console.log(code);
    location.href = '../homepage/member_data.html?' + 'code=' + this.getAttribute("vip_code");
  })

</script>

</html>