<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>我的会员</title>
  <link href="./mui/css/mui.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="./css/iconfont.css">
  <script src="./mui/js/muiR.js"></script>
  <script src="./js/jquery.min.js"></script>
  <link rel="stylesheet" href="./css/loading.css">
  <script src="./js/loading.js"></script>
  <style>
    .span_font_style {
      /* background-color: #3abeee; */
      background: -webkit-linear-gradient(0deg, rgba(233, 153, 4, 0.973), #f5f10cf1);
      /* Safari 5.1 - 6.0 */
      background: -o-linear-gradient(0deg, rgba(247, 168, 23, 0.973), #f5f10cf1);
      /* Opera 11.1 - 12.0 */
      background: -moz-linear-gradient(0deg, rgba(233, 153, 4, 0.973), #f5f10cf1);
      /* Firefox 3.6 - 15 */
      background: linear-gradient(0deg, rgba(233, 153, 4, 0.973), #f5f10cf1);
      /* 标准的语法（必须放在最后） */
      /* 标准的语法（必须放在最后） */
      color: white;
      background-color: orange;
      border-radius: 10px;
      font-size: 20px;
    }

    li {
      list-style: none;
      background-color: white;
      border-right: 1px solid #cccccc;
      border-bottom: 1px solid #cccccc;
      text-align: center;
    }

    a:hover {
      text-decoration: none;
    }

    .li_style {
      border-right: none;
      height: 147px;
    }

    .li_photo_style {
      border: 1px solid black;
    }

    .div_style {
      text-align: left;
      overflow: hidden;
      line-height: 40px;
    }

    .div_style_1 {
      border-bottom: 1px solid #cccccc;
    }

    .input_style {
      float: right;
      margin-bottom: 10px;
    }

    select {
      appearance: none;
      -moz-appearance: none;
      -webkit-appearance: none;
      /* select居中 */
      text-align-last: center;
    }

    .title_display {
      display: none;
    }

    /* 样式 */
    .oa-contact-cell.mui-table .mui-table-cell {
      padding: 8px 0 0 0;
      vertical-align: middle;
    }

    .oa-contact-cell {
      position: relative;
      /* margin-left: 10px; */
    }

    .oa-contact-content {
      width: 60%;

    }

    .oa-contact-name {
      width: 100%;
    }

    .oa-contact-name,
    oa-contact-position {
      float: left;
    }

    li {
      border: none;
    }

    .mui-select::before {
      color: rgb(11, 80, 246);
    }

    /* .mui-scroll-wrapper {
      margin-top: 20px;
    } */

    .mui-btn-danger {
      border: 1px solid #1b69f2;
      background-color: #1b69f2;
      font-size: 15px;
      letter-spacing: 2px;
      padding: 5px 12px;
    }

    .mui-table-view-cell:after {
      left: 0;
      background-color: #ececed;
    }

    .mui-table-view::before {
      background-color: #ececed;
    }

    .mui-table-view:after {
      background-color: #ececed;
    }

    .mui-search .mui-placeholder,
    .mui-input-row select {
      font-size: 14px;
      height: 30px;
    }

    .mui-content>.mui-table-view:first-child {
      margin-top: 0px;
    }

    .mui-table-view-cell {
      padding: 10px 15px;
    }

    .nstyle {
      text-align: center;
      font-size: 16px;
      letter-spacing: 1px;
    }

    .nstyle h3 {
      display: inline-block;
      font-size: 20px;
      color: #f5a473;
    }

    .mui-search:before {
      top: 60%;
    }
  </style>
</head>

<body>
  <header class="mui-bar mui-bar-nav">
    <h1 class="mui-title">会员列表</h1>
  </header>
  <div id="pullrefresh" class="mui-content mui-scroll-wrapper ">
    <div class="mui-scroll">

      <div id="member_h">
        <!-- 搜索 -->
        <div class="mui-input-row mui-search" style="height:40px;margin-top:18px;padding:0px;">
          <input type="search" class="mui-input-clear" placeholder="请输入会员姓名/卡号/手机号" style="background-color:white;"
            id="phone_num">
        </div>
        <!-- 选择机构-->
        <div class="mui-input-row mui-select">
          <select name="" style="color:rgb(105, 104,104);margin-bottom: 4px;" id="all_organization"
            onchange="gradeChange_organization(true)">
            <!-- <option value="">所有机构</option> -->
            <!-- <option value="">上海部门</option>
				            <option value="">海南部门</option>
				            <option value="">澳大利亚部门</option> -->
          </select>
        </div>
        <!-- 选择门店-->
        <div class="mui-input-row mui-select">
          <select name="" style="color:rgb(105, 104,104);margin-bottom: 4px;" id="all_stores"
            onchange="gradeChange_stores(true)">
            <!-- <option value="">所有门店</option> -->
            <!-- <option value="">上海部门</option>
				      <option value="">海南部门</option>  
				      <option value="">澳大利亚部门</option> -->
          </select>
        </div>
        <!-- 请选择导购 -->
        <div class="mui-input-row mui-select">
          <select name="" style="color:rgb(105, 104,104);margin-bottom: 4px;" id="all_shopping">
            <!-- <option value="">形象顾问</option> -->
            <!-- <option value="">上海部门</option>
				      <option value="">海南部门</option>
				      <option value="">澳大利亚部门</option> -->
          </select>
        </div>
        <!-- 不限 绑定 未绑定 id="all_shopping" -->
        <div class="mui-input-row mui-select">
          <select name="" style="color:rgb(105, 104,104);margin-bottom: 4px;" onchange="gradeChange_tying()"
            id="all_tying">
            <option value="true">不限</option>
            <option value="1">绑定</option>
            <option value="0">未绑定</option>
          </select>
        </div>


        <!-- 查询 -->
        <div class="mui-button-row" style="height: 45px;">
          <button type="button" class="mui-btn mui-btn-danger" style="width:300px;" id="query">查询</button>
        </div>
        <div class="nstyle">
          当前总条数:<h3 id="datanum"></h3>
        </div>
        <!-- 会员导航 -->
        <div class="mui-row">
          <div class="mui-col-xs-3 mui-col-sm-3">
            <li class="mui-table-view-cell" style="border-right:none">
              <a href="./homepage/screen.html">
                <span class="iconfont icon-group span_font_style"></span>
                <p>筛选器</p>
              </a>
            </li>
          </div>
          <div class="mui-col-xs-3 mui-col-sm-3">
            <li class="mui-table-view-cell" style="border-right:none">
              <a href="./homepage/new_addition_member.html">
                <span class="iconfont icon-creative span_font_style"></span>
                <p>新入会员</p>
              </a>
            </li>
          </div>
          <div class="mui-col-xs-3 mui-col-sm-3">
            <li class="mui-table-view-cell" style="border-right:none">
              <a href="./homepage/active_member.html">
                <span class="iconfont icon-friendfamous span_font_style"></span>
                <p>活跃会员</p>
              </a>
            </li>
          </div>
          <div class="mui-col-xs-3 mui-col-sm-3">
            <li class="mui-table-view-cell" style="border-right:none">
              <a href="./homepage/grade_member.html">
                <span class="iconfont icon-choiceness span_font_style"></span>
                <p>会员等级</p>
              </a>
            </li>
          </div>
        </div>
      </div>

      <div class="mui-content">
        <!--数据列表-->
        <ul class="mui-table-view mui-table-view-chevron" id="member_data">
          <!-- 里面详细内容 -->
          <!-- <li class="mui-table-view-cell" style="padding-left:5px;padding-right: 11px;">
				    <div class="mui-slider-cell">
				            <div class="oa-contact-cell mui-table">
                      <div class="mui-table-cell" style="width:100px;height:100px;">
                        

				                <img src="./images/g.jpg" style="width:79%;height:100%;border: 1px solid black;border-radius:50%;margin-left: 10px;" />
				              </div>
				  
				              <div class="oa-contact-content mui-table-cell" style="padding-top:10px;padding-left: 12px;">
				                <div class="mui-clearfix" style="text-align:left;line-height: 28px;width: 100%;padding: 12px 0 0 0;">
				                  <h4 class="oa-contact-name">叶文洁<span style="font-size:12px;color:#757171;margin-left: 15px;font-weight: normal;">1970-08-20</span></h4>
				                  <p class="mui-h6" style="text-align:left;width: 80%;margin: 0;">
				                    <span style="font-weight:bold;font-size:15px;">¥</span>
				                    <span>25.5</span>
				                    <span>&nbsp;/</span>
				                    <span>1</span>
				                    <span>&nbsp;积分</span>
				                  </p>
				                  <p style="font-size:15px;color: #757171;">
				                    订单时间 <span class="oa-contact-position mui-h5"style="color:#97989c;">1964-12-27</span>
				                  </p>
				                </div>
				              </div>
				  
				              <div class="mui-table-cell">
				                <button style="padding: 7px 10px;color: #77a1f8;border: 1px solid #77a1f8;">会员资料</button>
				                <button style="padding: 7px 10px;color: #77a1f8;border: 1px solid #77a1f8;margin-top:5%;">修改等级</button>
				              </div>
				  
				            </div>
				        </div>
				    </li> -->
        </ul>
      </div>

    </div>
  </div>

</body>
<script>
  mui('body').on('tap', 'a', function () {
    window.location.href = this.href;
  });
  var jsobs = {
    cont: JSON.parse(localStorage.getItem("membership_jsobs")).cont,
    phone: JSON.parse(localStorage.getItem("membership_jsobs")).phone,
    jigou: JSON.parse(localStorage.getItem("membership_jsobs")).jigou,
    store: JSON.parse(localStorage.getItem("membership_jsobs")).store,
    guwen: JSON.parse(localStorage.getItem("membership_jsobs")).guwen,
    weixin: JSON.parse(localStorage.getItem("membership_jsobs")).weixin,
  };

  var load = new Loading();
  load.init();

  // 样式控制滑动的高度
  var member_h = document.getElementById("member_h");
  var pullrefresh = document.getElementById("pullrefresh");
  var all_stores = document.getElementById("all_stores");
  var all_shopping = document.getElementById("all_shopping");
  // 进入加载的数据
  //获取父页面
  // var hd = window.parent.document.getElementById("hd");
  // //页面的margin-top
  // var hh = window.parent.document.getElementsByClassName("mui-iframe-wrapper");
  // function hidden_title() {
  //   hd.style.display = "";
  //   hh[0].style.top = "30px";
  // }
  window.onload = function () {
    // pullrefresh.style.marginTop = member_h.clientHeight + 18 + 'px';
    onload_select();
    onload_select_innerHTML();
  }
  // 下拉框初始赋值
  function onload_select_innerHTML() {
    // 给组织加载多余
    var option_all_organization = document.createElement("option");
    option_all_organization.value = "";
    option_all_organization.innerHTML = "选择机构";
    document.getElementById("all_organization").appendChild(option_all_organization);
    // 门店加载多余 
    var option_all_stores = document.createElement("option");
    option_all_stores.value = "";
    option_all_stores.innerHTML = "选择门店";
    document.getElementById("all_stores").appendChild(option_all_stores);
    // 形象顾问加载多余
    var option_all_shopping = document.createElement("option");
    option_all_shopping.value = "";
    option_all_shopping.innerHTML = "选择店员";
    document.getElementById("all_shopping").appendChild(option_all_shopping);

  }
  // //select安卓和ios的判断样式
  var picture3 = document.getElementById("all_organization");
  var picture = document.getElementById("all_stores");
  var picture1 = document.getElementById("all_shopping");
  var picture2 = document.getElementById("all_tying");
  //苹果手机采用CSS1
  if (/iphone/i.test(navigator.userAgent)) {
    picture3.style.paddingLeft = "42%";
    picture.style.paddingLeft = "42%";
    picture1.style.paddingLeft = "40%";
    picture2.style.paddingLeft = "42%";
    // addStyleLink('CSS1.css');

  }
  // 安卓手机采用CSS2
  if (/android/i.test(navigator.userAgent)) {
    //alert("安卓");
    picture3.style.paddingLeft = "0px";
    picture.style.paddingLeft = "0px";
    picture1.style.paddingLeft = "0px";
    picture2.style.paddingLeft = "0px";
    // addStyleLink('CSS2.css');

  }

  function zidongxuanze() {
    if (jsobs.jigou != "") {
      displays("all_organization", jsobs.jigou);
      mui.post('/index.php/UserlistStore/', {
        code: jsobs.jigou
      }, function (data) {
        //服务器返回响应，根据响应结果，分析是否登录成功；
        if (data.code == 200) {
          document.getElementById("all_stores").innerHTML = '<option value="">选择门店</option>'
          for (i = 0; i < data.data.length; i++) {
            var option = document.createElement('option');
            option.value = data.data[i].code;
            option.innerHTML = data.data[i].name;
            document.getElementById("all_stores").appendChild(option);
          }
          if (jsobs.store != "") {
            displays("all_stores", jsobs.store);
            mui.post('/index.php/UserlistStaff/', {
              code: jsobs.store
            }, function (data) {
              //服务器返回响应，根据响应结果，分析是否登录成功；
              if (data.code == 200) {
                document.getElementById("all_shopping").innerHTML = '<option value="">选择店员</option>'
                for (i = 0; i < data.data.length; i++) {
                  var option = document.createElement('option');
                  option.value = data.data[i].code;
                  option.innerHTML = data.data[i].name;
                  document.getElementById("all_shopping").appendChild(option);
                }
                if (jsobs.guwen != "") {
                  displays("all_shopping", jsobs.guwen)
                }

              }
            }, 'json'
            );
          }

        }
      }, 'json'
      );

    }
  }
  // 进来加载的方法
  // 选择组织
  function onload_select() {

    mui.post('/index.php/UserlistOrg/', {
    }, function (data) {
      //服务器返回响应，根据响应结果，分析是否登录成功；
      if (data.code == 200) {
        for (i = 0; i < data.data.length; i++) {
          var option = document.createElement('option');
          option.value = data.data[i].code;
          option.innerHTML = data.data[i].name
          document.getElementById("all_organization").appendChild(option);
        }

        if (jsobs.cont != false) {
          if (jsobs.phone != "") {
            document.getElementById("phone_num").value = jsobs.phone;
          }
          if (jsobs.weixin != "") {
            displays("all_tying", jsobs.weixin)
          }
          zidongxuanze();
        }






      }
    }, 'json'
    );
  }

  // 进来加载组织

  function gradeChange_organization(ttt) {

    load.start();

    mui.post('/index.php/UserlistStore/', {
      code: document.getElementById("all_organization").options[document.getElementById("all_organization").selectedIndex].value
    }, function (data) {
      //服务器返回响应，根据响应结果，分析是否登录成功；
      if (data.code == 200) {
        document.getElementById("all_stores").innerHTML = '<option value="">选择门店</option>'
        for (i = 0; i < data.data.length; i++) {
          var option = document.createElement('option');
          option.value = data.data[i].code;
          option.innerHTML = data.data[i].name;
          document.getElementById("all_stores").appendChild(option);
        }
        jsobs.store = "";
        jsobs.guwen = "";
        load.stop();
      }
    }, 'json'
    );


  }
  // 选择门店 店员下拉发生改变
  function gradeChange_stores(ttt) {
    load.start();
    jsobs.guwen = "";
    mui.post('/index.php/UserlistStaff/', {
      code: all_stores.options[all_stores.selectedIndex].value
    }, function (data) {
      //服务器返回响应，根据响应结果，分析是否登录成功；
      if (data.code == 200) {
        document.getElementById("all_shopping").innerHTML = '<option value="">选择店员</option>'
        for (i = 0; i < data.data.length; i++) {
          var option = document.createElement('option');
          option.value = data.data[i].code;
          option.innerHTML = data.data[i].name;
          document.getElementById("all_shopping").appendChild(option);
        }
        jsobs.guwen = "";
        load.stop();
      }
    }, 'json'
    );


  }
  //绑定未绑定
  function gradeChange_tying() {
    var value = document.getElementById('all_tying').options[document.getElementById('all_tying').selectedIndex].value; // 选中值
    return value;
  }


  // 点击按钮查询

  var query = document.getElementById("query");
  query.onclick = function () {
    select_org = document.getElementById("all_organization").options[document.getElementById("all_organization").selectedIndex].value;
    select_store = all_stores.options[all_stores.selectedIndex].value;
    select_staff = all_shopping.options[all_shopping.selectedIndex].value
    
    jsobs.cont = true;
    jsobs.phone = document.getElementById("phone_num").value;
    jsobs.jigou = select_org;
    jsobs.store = select_store;
    jsobs.guwen = select_staff;
    jsobs.weixin = gradeChange_tying();
    localStorage.setItem("membership_jsobs", JSON.stringify(jsobs));
    document.getElementById("member_data").innerHTML = "";
    count = 0;
    mui('#pullrefresh').pullRefresh().refresh(true);
    pullupRefresh();
  }
</script>
<script>
  mui.init({
    pullRefresh: {
      container: '#pullrefresh',
      //       down: {
      //         callback: pulldownRefresh
      //       },
      up: {
        contentrefresh: '正在加载...',
        auto: true,//可选,默认false.首次加载自动上拉刷新一次
        callback: pullupRefresh
      }
    }
  });
  /**
   * 下拉刷新具体业务实现
   */

  function pulldownRefresh() {
  }
  /**
   * 上拉加载具体业务实现
   */
  // 重新开启加载
  // mui('#pullrefresh').pullRefresh().refresh(true);
  // 分页计数
  var select_org = "";
  var select_store = "";
  var select_staff = "";
  var count = 0;
  // 分的条数
  var limit_num = 30;

  function pullupRefresh() {
    load.start();
    if (jsobs.cont == false) {
      mui.post('/index.php/Userlist/', {
        org: select_org,
        store: select_store,//所有门店
        staff: select_staff,//所有员工
        vague: document.getElementById("phone_num").value,
        page: ++count,
        limit: limit_num,
        type: gradeChange_tying()
      }, function (data) {
        if (data.code == 200) {
          if ((data.data == "") || (data.data == null) || (data.data == undefined)) {
            mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
            load.stop();
          } else {
            document.getElementById("datanum").innerHTML = data.data.list.count;
            //服务器返回响应，根据响应结果，分析是否登录成功；
            setTimeout(function () {
              mui('#pullrefresh').pullRefresh().endPullupToRefresh((count > (data.data.list.count / limit_num))); //参数为true代表没有更多数据了。
              var table = document.body.querySelector('.mui-table-view');
              if (data.data.list.count == 0) {
                var li = document.createElement('li');
                li.className = 'mui-table-view-cell';
                li.style = 'padding-top:20px;padding-bottom:20px;text-align:center;'
                li.innerHTML = "<h1>暂无数据</h1>"
                table.appendChild(li);
              } else {
                for (i = 0; i < data.data.list.data.length; i++) {
                  var wexin_title = "";
                  // alert(data.count.list.data.length)
                  // 进行判断,如果为空执行默认路径的图片
                  if (data.data.list.data[i].img == "" || data.data.list.data[i].img == null || data.data.list.data[i].img == " ") {
                    data.data.list.data[i].img = "./images/suoke.jpg";
                  }
                  if (data.data.list.data[i].vvip == 1) {
                    wexin_title = '<span class="mui-icon mui-icon-weixin" style="position: relative;top:10px;right: -36%;;z-index: 999;color: #80D640;"></span>';
                  }
                  if (data.data.list.data[i].username == "" || data.data.list.data[i].username == null || data.data.list.data[i].username == undefined) {
                    data.data.list.data[i].username = '&nbsp;';
                  }
                  if (data.data.list.data[i].birthday == "" || data.data.list.data[i].birthday == null || data.data.list.data[i].birthday == undefined) {
                    data.data.list.data[i].birthday = '';
                  }
                  if (data.data.list.data[i].total_consumption == "" || data.data.list.data[i].total_consumption == null || data.data.list.data[i].total_consumption == undefined) {
                    data.data.list.data[i].total_consumption = 0;
                  }
                  if (data.data.list.data[i].consumption_number == "" || data.data.list.data[i].consumption_number == null || data.data.list.data[i].consumption_number == undefined) {
                    data.data.list.data[i].consumption_number = 0;
                  }
                  if (data.data.list.data[i].consumption_times == "" || data.data.list.data[i].consumption_times == null || data.data.list.data[i].consumption_times == undefined) {
                    data.data.list.data[i].consumption_times = '';
                  }
                  if (data.data.list.data[i].r_days == null || data.data.list.data[i].r_days == undefined || data.data.list.data[i].r_days == "") {
                    data.data.list.data[i].r_days = "未消费";
                  } else if (data.data.list.data[i].r_days != "未消费") {
                    data.data.list.data[i].r_days = "未消费" + data.data.list.data[i].r_days + "天";
                  }
                  if (data.data.list.data[i].return_visit == null || data.data.list.data[i].return_visit == undefined || data.data.list.data[i].return_visit == "") {
                    data.data.list.data[i].return_visit = "未回访";
                  } else if (data.data.list.data[i].return_visit != "未回访") {
                    data.data.list.data[i].return_visit = parseInt(data.data.list.data[i].return_visit.replace(/,/g, ""));
                    if (data.data.list.data[i].return_visit > 365) {
                      data.data.list.data[i].return_visit = "未回访365+天";
                    } else {
                      data.data.list.data[i].return_visit = "未回访" + data.data.list.data[i].return_visit + "天";
                    }
                  }

                  var li = document.createElement('li');
                  li.className = 'mui-table-view-cell';
                  li.style = 'padding-left:5px;padding-right: 11px;padding-top:0;margin-top:0;';
                  li.innerHTML = '<div class="mui-slider-cell">'
                    + '<div class="oa-contact-cell mui-table">'
                    + '<div class="mui-table-cell" style="width:70px;margin-left: 10px;">'
                    + wexin_title
                    + '<img src="' + data.data.list.data[i].img + '" alt="暂无图片"style="width:100%;border: 1px solid #eee;border-radius:50%;" />'
                    + '</div>'

                    + '<div class="oa-contact-content mui-table-cell" style="padding-top:0px;padding-left: 12px;">'
                    + '<div class="mui-clearfix" style="text-align:left;line-height: 28px;width: 100%;">'
                    + '<h4 class="oa-contact-name">' + data.data.list.data[i].username + '<span style="font-size:12px;color:#757171;margin-left: 15px;font-weight: normal;">' + data.data.list.data[i].birthday + '</span></h4>'
                    + '<p class="mui-h6" style="text-align:left;width: 80%;margin-bottom: 0px;line-height:20px;">'
                    + '<span style="font-weight:bold;font-size:15px;">¥</span>'
                    + '<span> ' + data.data.list.data[i].total_consumption + '</span>'
                    + '<span>&nbsp;/</span>'
                    + '<span> ' + data.data.list.data[i].consumption_times + '</span>'
                    + '<span>次 / ' + data.data.list.data[i].consumption_number + '件</span>'
                    + '</p>'
                    + '<p style="font-size:12px;color: #757171;line-height: 25px;">'
                    + '<span class="oa-contact-position" style="color:#97989c;">' + data.data.list.data[i].r_days + '</span> / '
                    + '<span class="oa-contact-position" style="color:#97989c;">' + data.data.list.data[i].return_visit + '</span>'
                    + '</p>'
                    + '</div>'
                    + '</div>'
                    + '<div class="mui-table-cell" style="width: 25%;">'
                    + '<button style="padding: 7px 10px;color: #77a1f8;border: 1px solid #77a1f8;" name="' + data.data.list.data[i].code + '"onclick="member(this)">会员资料</button>'
                    + '<button style="padding: 7px 10px;color: #77a1f8;border: 1px solid #77a1f8;margin-top:7%;" name="' + data.data.list.data[i].code + '"onclick="grade(this)">修改等级</button>'
                    + '</div>'
                    + '</div>'
                    + '</div>'
                  table.appendChild(li);
                }
              }
              load.stop();
            }, 1000);
          }

        }
      }, 'json'
      );
    } else {
      console.log('机构:' + jsobs.jigou);
      console.log('门店:' + jsobs.store);
      console.log('员工:' + jsobs.guwen);
      mui.post('/index.php/Userlist/', {
        org: jsobs.jigou,
        store: jsobs.store,//所有门店
        staff: jsobs.guwen,//所有员工
        vague: jsobs.phone,
        page: ++count,
        limit: limit_num,
        type: jsobs.weixin
      }, function (data) {
        if (data.code == 200) {
          if ((data.data == "") || (data.data == null) || (data.data == undefined)) {
            mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
            load.stop();
          } else {
            document.getElementById("datanum").innerHTML = data.data.list.count;
            //服务器返回响应，根据响应结果，分析是否登录成功；
            setTimeout(function () {
              mui('#pullrefresh').pullRefresh().endPullupToRefresh((count > (data.data.list.count / limit_num))); //参数为true代表没有更多数据了。
              var table = document.body.querySelector('.mui-table-view');
              if (data.data.list.count == 0) {
                var li = document.createElement('li');
                li.className = 'mui-table-view-cell';
                li.style = 'padding-top:20px;padding-bottom:20px;text-align:center;'
                li.innerHTML = "<h1>暂无数据</h1>"
                table.appendChild(li);
              } else {
                for (i = 0; i < data.data.list.data.length; i++) {
                  var wexin_title = "";
                  // alert(data.count.list.data.length)
                  // 进行判断,如果为空执行默认路径的图片
                  if (data.data.list.data[i].img == "" || data.data.list.data[i].img == null || data.data.list.data[i].img == " ") {
                    data.data.list.data[i].img = "./images/suoke.jpg";
                  }
                  if (data.data.list.data[i].vvip == 1) {
                    wexin_title = '<span class="mui-icon mui-icon-weixin" style="position: relative;top:10px;right: -36%;;z-index: 999;color: #80D640;"></span>';
                  }
                  if (data.data.list.data[i].username == "" || data.data.list.data[i].username == null || data.data.list.data[i].username == undefined) {
                    data.data.list.data[i].username = '&nbsp;';
                  }
                  if (data.data.list.data[i].birthday == "" || data.data.list.data[i].birthday == null || data.data.list.data[i].birthday == undefined) {
                    data.data.list.data[i].birthday = '';
                  }
                  if (data.data.list.data[i].total_consumption == "" || data.data.list.data[i].total_consumption == null || data.data.list.data[i].total_consumption == undefined) {
                    data.data.list.data[i].total_consumption = 0;
                  }
                  if (data.data.list.data[i].consumption_number == "" || data.data.list.data[i].consumption_number == null || data.data.list.data[i].consumption_number == undefined) {
                    data.data.list.data[i].consumption_number = 0;
                  }
                  if (data.data.list.data[i].consumption_times == "" || data.data.list.data[i].consumption_times == null || data.data.list.data[i].consumption_times == undefined) {
                    data.data.list.data[i].consumption_times = '';
                  }
                  if (data.data.list.data[i].r_days == null || data.data.list.data[i].r_days == undefined || data.data.list.data[i].r_days == "") {
                    data.data.list.data[i].r_days = "未消费";
                  } else if (data.data.list.data[i].r_days != "未消费") {
                    data.data.list.data[i].r_days = "未消费" + data.data.list.data[i].r_days + "天";
                  }
                  if (data.data.list.data[i].return_visit == null || data.data.list.data[i].return_visit == undefined || data.data.list.data[i].return_visit == "") {
                    data.data.list.data[i].return_visit = "未回访";
                  } else if (data.data.list.data[i].return_visit != "未回访") {
                    data.data.list.data[i].return_visit = parseInt(data.data.list.data[i].return_visit.replace(/,/g, ""));
                    if (data.data.list.data[i].return_visit > 365) {
                      data.data.list.data[i].return_visit = "未回访365+天";
                    } else {
                      data.data.list.data[i].return_visit = "未回访" + data.data.list.data[i].return_visit + "天";
                    }
                  }

                  var li = document.createElement('li');
                  li.className = 'mui-table-view-cell';
                  li.style = 'padding-left:5px;padding-right: 11px;padding-top:0;margin-top:0;';
                  li.innerHTML = '<div class="mui-slider-cell">'
                    + '<div class="oa-contact-cell mui-table">'
                    + '<div class="mui-table-cell" style="width:70px;margin-left: 10px;">'
                    + wexin_title
                    + '<img src="' + data.data.list.data[i].img + '" alt="暂无图片"style="width:100%;border: 1px solid #eee;border-radius:50%;" />'
                    + '</div>'

                    + '<div class="oa-contact-content mui-table-cell" style="padding-top:0px;padding-left: 12px;">'
                    + '<div class="mui-clearfix" style="text-align:left;line-height: 28px;width: 100%;">'
                    + '<h4 class="oa-contact-name">' + data.data.list.data[i].username + '<span style="font-size:12px;color:#757171;margin-left: 15px;font-weight: normal;">' + data.data.list.data[i].birthday + '</span></h4>'
                    + '<p class="mui-h6" style="text-align:left;width: 80%;margin-bottom: 0px;line-height:20px;">'
                    + '<span style="font-weight:bold;font-size:15px;">¥</span>'
                    + '<span> ' + data.data.list.data[i].total_consumption + '</span>'
                    + '<span>&nbsp;/</span>'
                    + '<span> ' + data.data.list.data[i].consumption_times + '</span>'
                    + '<span>次 / ' + data.data.list.data[i].consumption_number + '件</span>'
                    + '</p>'
                    + '<p style="font-size:12px;color: #757171;line-height: 25px;">'
                    + '<span class="oa-contact-position" style="color:#97989c;">' + data.data.list.data[i].r_days + '</span> / '
                    + '<span class="oa-contact-position" style="color:#97989c;">' + data.data.list.data[i].return_visit + '</span>'
                    + '</p>'
                    + '</div>'
                    + '</div>'
                    + '<div class="mui-table-cell" style="width: 25%;">'
                    + '<button style="padding: 7px 10px;color: #77a1f8;border: 1px solid #77a1f8;" name="' + data.data.list.data[i].code + '"onclick="member(this)">会员资料</button>'
                    + '<button style="padding: 7px 10px;color: #77a1f8;border: 1px solid #77a1f8;margin-top:7%;" name="' + data.data.list.data[i].code + '"onclick="grade(this)">修改等级</button>'
                    + '</div>'
                    + '</div>'
                    + '</div>'
                  table.appendChild(li);
                }
              }
              load.stop();
            }, 1000);
          }

        }
      }, 'json'
      );
    }


  }
  mui('.mui-scroll-wrapper').scroll({
    indicators: false, //是否显示滚动条
  });
  // 点击按钮,将参数传递到另一个页面
  function member(e) {
    location.href = '../homepage/member_data.html?' + 'code=' + e.getAttribute("name");
  }
  function grade(e) {
    location.href = '../homepage/member_grade.html?' + 'code=' + e.getAttribute("name");
  }


  function displays(selectID, optionID) {
    $("#" + selectID).find("option[value='" + optionID + "']").attr("selected", true);

  };
</script>
<!-- 返回跳出 -->
<script>
  // pushHistory();
  // window.addEventListener("popstate", function (e) {
  //   // alert(789);
  //   top.location.href = 'index_main.html';
  // }, false);
  // function pushHistory() {
  //   var state = {
  //     title: "title",
  //     url: "#"
  //   };
  //   window.history.pushState(state, "title", "#");
  // }
</script>

</html>